{% extends "based/base.html" %}
{% load crispy_forms_tags %}

{% block title %}{{ task.title }} | Ğ—Ğ°Ğ²Ğ´Ğ°Ğ½Ğ½Ñ{% endblock %}

{% block content %}
  <div class="card shadow-sm mb-4">
    <div class="card-body">
      <h2 class="mb-3">{{ task.title }}</h2>
      <p><strong>ğŸ‘¤ ĞĞ²Ñ‚Ğ¾Ñ€:</strong> {{ task.author }}</p>
      <p><strong>ğŸ“ ĞĞ¿Ğ¸Ñ:</strong> {{ task.description }}</p>
      <p><strong>ğŸ“Œ Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ:</strong> {{ task.get_status_display }}</p>
      <p><strong>âš¡ ĞŸÑ€Ñ–Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚:</strong> {{ task.get_priority_display }}</p>
      <p><strong>ğŸ“… Ğ¢ĞµÑ€Ğ¼Ñ–Ğ½:</strong> {{ task.due_date }}</p>

      <div class="mt-3">
        <a href="{% url 'task-edit' task.pk %}" class="btn btn-warning btn-sm">âœï¸ Ğ ĞµĞ´Ğ°Ğ³ÑƒĞ²Ğ°Ñ‚Ğ¸</a>
        <a href="{% url 'task-delete' task.pk %}" class="btn btn-danger btn-sm">ğŸ—‘ï¸ Ğ’Ğ¸Ğ´Ğ°Ğ»Ğ¸Ñ‚Ğ¸</a>
        <a href="{% url 'task-list' %}" class="btn btn-secondary btn-sm">â¬… ĞĞ°Ğ·Ğ°Ğ´</a>
      </div>
    </div>
  </div>

  <div class="mt-4">
    <h4>ğŸ’¬ ĞšĞ¾Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ñ–:</h4>
    {% if task.comments.all %}
      <ul class="list-group mb-3">
        {% for comment in task.comments.all %}
        <li class="list-group-item d-flex justify-content-between align-items-start">
            <div>
              <strong>{{ comment.author.username }}</strong>
              <small class="text-muted"> â€” {{ comment.created_at|date:"d.m.Y H:i" }}</small>
              <p class="mb-0 mt-1 text-dark">{{ comment.text|linebreaks }}</p>
            </div>
          
            {% if user == comment.author or user.is_staff %}
              <form method="post" action="{% url 'delete-comment' comment.pk %}" style="margin-left: 10px;">
                {% csrf_token %}
                <button type="submit" class="btn btn-outline-danger btn-sm" title="Ğ’Ğ¸Ğ´Ğ°Ğ»Ğ¸Ñ‚Ğ¸">
                  ğŸ—‘ï¸
                </button>
              </form>
            {% endif %}
          </li>          
        {% endfor %}
      </ul>
    {% else %}
      <p>ĞŸĞ¾ĞºĞ¸ Ñ‰Ğ¾ Ğ½ĞµĞ¼Ğ°Ñ” ĞºĞ¾Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ñ–Ğ².</p>
    {% endif %}
  </div>

  {% if user.is_authenticated %}
    <div class="card shadow-sm mt-4">
      <div class="card-body">
        <h5 class="mb-3">ğŸ–Šï¸ Ğ”Ğ¾Ğ´Ğ°Ñ‚Ğ¸ ĞºĞ¾Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€:</h5>
        <form method="post" action="{% url 'add-comment' task.pk %}">
          {% csrf_token %}
          {{ comment_form|crispy }}
          <button type="submit" class="btn btn-primary btn-sm">ğŸ’¬ ĞĞ°Ğ´Ñ–ÑĞ»Ğ°Ñ‚Ğ¸</button>
        </form>
      </div>
    </div>
  {% else %}
    <div class="alert alert-info mt-4">
      <a href="{% url 'login' %}">Ğ£Ğ²Ñ–Ğ¹Ğ´Ñ–Ñ‚ÑŒ</a>, Ñ‰Ğ¾Ğ± Ğ·Ğ°Ğ»Ğ¸ÑˆĞ¸Ñ‚Ğ¸ ĞºĞ¾Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€.
    </div>
  {% endif %}
{% endblock %}
